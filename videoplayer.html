<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>


    <div class="videopreview" loopstart="10" looplenght="7">
        <iframe
            src="https://player.vimeo.com/video/801165685?h=5eaf033648&autoplay=1&loop=1&title=0&byline=0&portrait=0&background=1"
            frameborder="0" allow="autoplay; fullscreen; picture-in-picture"></iframe>
        <div class="controls">
            <div class="controls-top">
                <button class="showinfo">Show Information</button>
                <button class="close">Close</button>
                <div class="information">
                    <table>
                        <tr>
                            <td>Director</td>
                            <td>Name</td>
                        </tr>
                        <tr>
                            <td>DOP</td>
                            <td>Name</td>
                        </tr>
                        <tr>
                            <td>Set Design</td>
                            <td>Name</td>
                        </tr>
                        <tr>
                            <td>Color Grading</td>
                            <td>Name</td>
                        </tr>
                        <tr>
                            <td>Sound Design</td>
                            <td>Name</td>
                        </tr>
                        <tr>
                            <td>Story</td>
                            <td>Name</td>
                        </tr>
                        <tr>
                            <td>Year</td>
                            <td>2023</td>
                        </tr>
                    </table>
                </div>
            </div>
            <div class="controls-bottom">
                <div class="video-title">
                    <span>willhaben </span>
                    <span class="klammertext">(Du suchst einen neuen Job? - KÃ¼che)</span>
                </div>
                <button class="playstop">
                    Stop
                </button>
                <span class="current-timestamp">00:00</span>
                <div class="progressbar">
                    <span class="current-time"></span>
                </div>
                <span class="videoduration"></span>
                <button class="sound">Sound OFF</button>
                <button class="share">Share</button>
                <button class="fullscreen">Fullscreen</button>
            </div>
        </div>
        <div class="clipboard">
            Link Copied To Clipboard
        </div>
    </div>

    <script src="https://player.vimeo.com/api/player.js"></script>
    <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>

    <script>
        const videoPreviews = document.querySelectorAll(".videopreview");
        videoPreviews.forEach((preview, index) => {
            var currentTime = preview.querySelector('.current-time');
            var iframe = preview.querySelector('iframe');
            var player = new Vimeo.Player(iframe);
            var progressbar = preview.querySelector('.progressbar');
            var sound = preview.querySelector('.sound');
            var playstop = preview.querySelector('.playstop');
            var paused = false;
            var close = preview.querySelector('.close');
            var infobutton = preview.querySelector('.showinfo')
            var info = preview.querySelector('.information')
            var share = preview.querySelector('.share')
            var clipboard = preview.querySelector('.clipboard')
            var currenttimestamp = preview.querySelector('.current-timestamp')
            var videolenght = preview.querySelector('.videoduration')
            var fullscreen = preview.querySelector('.fullscreen')
            var loopstart = preview.getAttribute('loopstart')
            var looplenght = preview.getAttribute('looplenght')

            player.getDuration().then(function (duration) {
                var videoDuration = duration;
                var minutes = Math.floor(videoDuration / 60);
                var seconds = Math.floor(videoDuration % 60);
                var formattedTime = minutes.toString().padStart(2, '0') + ':' + seconds.toString().padStart(2, '0');
                videolenght.textContent = formattedTime;
            }).catch(function (error) {
            });

            fullscreen.addEventListener('click', function () {
                if (preview.requestFullscreen) {
                    preview.requestFullscreen();
                } else if (preview.webkitRequestFullscreen) { 
                    preview.webkitRequestFullscreen();
                } else if (preview.msRequestFullscreen) { 
                    preview.msRequestFullscreen();
                }

                if (document.exitFullscreen) {
                    document.exitFullscreen();
                } else if (document.webkitExitFullscreen) { 
                    document.webkitExitFullscreen();
                } else if (document.msExitFullscreen) { 
                    document.msExitFullscreen();
                }
                fullscreen.innerText = fullscreen.innerText === "Fullscreen" ? "Minimize" : "Fullscreen";
            });

            player.setCurrentTime(loopstart).then(function (seconds) {
            }).catch(function (error) {
            });

            player.play().then(function () {
                var interval = setInterval(function () {
                    if (!preview.classList.contains("clicked")) {
                        player.getCurrentTime().then(function (seconds) {
                            if (seconds >= looplenght) {
                                player.setCurrentTime(loopstart).then(function (seconds) {
                                }).catch(function (error) {
                                });
                            }
                        }).catch(function (error) {
                        });
                    }
                }, looplenght * 1000);

            }).catch(function (error) {
            });

            preview.addEventListener("click", () => {

                if (!preview.classList.contains("clicked")) {
                    preview.classList.add("clicked");
                    clicked = document.querySelector('.clicked');
                    player.setCurrentTime(0).then(function (seconds) {
                    }).catch(function (error) {
                    });
                }

            });

            player.on('timeupdate', function (data) {
                currentTime.style.width = data.percent * 100 + '%';
                var currentTimeStamp = data.seconds;
                var minutes = Math.floor(currentTimeStamp / 60);
                var seconds = Math.floor(currentTimeStamp % 60);
                var formattedTime = minutes.toString().padStart(2, '0') + ':' + seconds.toString().padStart(2, '0');
                currenttimestamp.textContent = formattedTime;
            });

            progressbar.addEventListener('click', function (event) {
                var offsetX = event.offsetX;
                var width = progressbar.offsetWidth;
                var percentage = offsetX / width;
                var percent;
                player.getDuration().then(function (duration) {
                    var percent = duration * percentage;
                    player.setCurrentTime(percent).then(function (seconds) {
                    }).catch(function (error) {
                    });
                }).catch(function (error) {
                });
            });

            sound.addEventListener('click', function (event) {
                console.log('here')

                player.getMuted().then(function (muted) {

                    player.setMuted(!muted).then(function (muted) {
                        sound.innerText = muted ? "Sound OFF" : "Sound ON"

                    }).catch(function (error) {
                    });

                }).catch(function (error) {
                });

            });

            close.addEventListener("click", function (event) {
                player.setMuted(true).then(function (muted) {
                }).catch(function (error) {
                });
                fullscreen.innerText = "Fullscreen";
                player.setCurrentTime(loopstart).then(function (seconds) {
                }).catch(function (error) {
                });
                player.play().then(function () {
                }).catch(function (error) {
                });

                if (document.exitFullscreen) {
                    document.exitFullscreen();
                } else if (document.webkitExitFullscreen) { 
                    document.webkitExitFullscreen();
                } else if (document.msExitFullscreen) { 
                    document.msExitFullscreen();
                }

                clipboard.style.display = "none";
            });

            playstop.addEventListener("click", function (event) {

                if (paused) {
                    player.play().then(function () {
                        paused = false;
                        playstop.innerText = "Stop"
                    }).catch(function (error) {
                        
                    });
                } else {
                    player.pause().then(function () {
                        paused = true;
                        playstop.innerText = "Play";
                    }).catch(function (error) {
                        
                    });
                }
            })

            infobutton.addEventListener("click", function (event) {
                info.style.display = info.style.display === "block" ? "none" : "block";
                infobutton.innerText = infobutton.innerText === "Show Information" ? "Hide Information" : "Show Information"
            })

            $(document).on("click", ".close", function () {
                $(".videopreview").removeClass("clicked");
            });

            var url = window.location.href;

            share.addEventListener("click", function (event) {
                navigator.clipboard.writeText(url);
                $(clipboard).fadeIn();
                setTimeout(function () {
                    $(clipboard).fadeOut();
                }, 2000);
            });
        });

    </script>











</body>

</html>